name: Windows VPS via RDP

on:
  workflow_dispatch: # Cháº¡y thá»§ cÃ´ng tá»« GitHub Actions

jobs:
  build:
    runs-on: windows-latest # Cháº¡y trÃªn mÃ¡y áº£o Windows
    timeout-minutes: 60     # VPS tá»“n táº¡i 60 phÃºt

    steps:
    - name: ğŸš€ Khá»Ÿi táº¡o VPS Windows
      run: |
        echo "Windows VPS Ä‘ang khá»Ÿi cháº¡y..."

    # Báº­t RDP vÃ  thiáº¿t láº­p tÃ i khoáº£n
    - name: ğŸ”§ Báº­t RDP vÃ  cáº¥u hÃ¬nh User
      run: |
        # Táº¡o user RDP
        net user runner Rdp@12345 /add
        net localgroup administrators runner /add
        REG ADD "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
        netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
        echo "User: runner | Pass: Rdp@12345" >> $env:GITHUB_WORKSPACE\rdp_info.txt

    # CÃ i Ä‘áº·t Cloudflare Tunnel
    - name: ğŸŒ CÃ i Ä‘áº·t Cloudflare Tunnel
      shell: pwsh
      run: |
        Invoke-WebRequest https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe -OutFile cloudflared.exe

    # Cháº¡y Tunnel Ä‘á»ƒ káº¿t ná»‘i RDP
    - name: ğŸŒ Khá»Ÿi cháº¡y Cloudflare Tunnel
      shell: pwsh
      run: |
        Start-Process -NoNewWindow -FilePath .\cloudflared.exe -ArgumentList "tunnel --url tcp://localhost:3389 --metrics localhost:49312" -PassThru
        Start-Sleep -Seconds 10
        Get-Content .\cloudflared.log -ErrorAction SilentlyContinue

    # Hiá»ƒn thá»‹ link káº¿t ná»‘i RDP
    - name: ğŸ“¢ Hiá»ƒn thá»‹ thÃ´ng tin RDP
      shell: pwsh
      run: |
        echo "===== VPS Windows Ä‘Ã£ sáºµn sÃ ng ====="
        echo "User: runner"
        echo "Password: Rdp@12345"
        echo "Kiá»ƒm tra Logs Ä‘á»ƒ láº¥y link Cloudflare Tunnel"
